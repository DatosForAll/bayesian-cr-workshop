<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Dead or alive: Survival estimation</title>
    <meta charset="utf-8" />
    <meta name="author" content="The team" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

# Dead or alive: Survival estimation
### The team
### last updated: 2021-04-06

---




## Plan
+ Time-variation
+ Model selection w/ wAIC
+ Include individual and temporal covariates (continuous, discrete; sex, age, etc)
+ Random effects
+ Why Bayes? Incorporating information through prior
+ What to do w/ missing values (discretization and multistate, fill in NAs Bonner, Langrock)
+ Predictive prior/posterior checks

---
# Model selection

---
## How to select a best model?

+ Is there any effect of rain or temperature or both on breeding success?

+ The proportion of explained variance `\(R^2\)` is problematic, because the more variables you have, the bigger `\(R^2\)` is.

+ Idea: **penalize models with too many parameters**.

---
## Akaike information criterion (AIC)

`$$AIC = - 2 \log(L(\hat{\theta}_1,\ldots,\hat{\theta}_K)) + 2 K$$`

with `\(L\)` the likelihood and `\(K\)` the number of parameters `\(\theta_i\)`.

---
## Akaike information criterion (AIC)

`$$\text{AIC} = {\color{red}{- 2 \log(L(\hat{\theta}_1,\ldots,\hat{\theta}_K))}} + 2 K$$`

\textcolor{red}{A measure of goodness-of-fit of the model to the data}: the more parameters you have, the smaller the deviance is (or the bigger the likelihood is).

---
## Akaike information criterion (AIC)

`$$\text{AIC} = - 2 \log(L(\hat{\theta}_1,\ldots,\hat{\theta}_K)) + {\color{red}{2 K}}$$`

\textcolor{red}{A penalty}: twice the number of parameters `\(K\)`

---
## Akaike information criterion (AIC)

+ AIC makes the balance between *quality of fit* and *complexity* of a model.

+ Best model is the one with lowest AIC value.

+ Two models are difficult to distinguish if `\(\Delta \text{AIC} &lt; 2\)`.

---
## Bayesian version

+ Watanabe-Akaike (Widely-Applicable) Information Criteria or WAIC:

`$$\textrm{WAIC} = -2 \sum_{i = 1}^n \log E[\Pr(y_i \mid \theta)] + 
                  2 p_\text{WAIC}$$`

+ where `\(E[p(y_i \mid \theta)]\)` is the posterior mean of the likelihood evaluated pointwise at each `\(i\)`th observation.

+ `\(p_\text{WAIC}\)` is a penalty computed using the posterior variance of the likelihood. 

+ More in this video &lt;https://www.youtube.com/watch?v=vSjL2Zc-gEQ&gt; by R. McElreath.


---
# How to incorporate prior information? 

+ So far, we have assumed a vague prior:

`$$\phi_{prior} \sim \text{Beta}(1,1) = \text{Uniform}(0,1)$$`

+ How to incorporate prior information?

---
# How to incorporate prior information?

--

+ If no information, mean posterior survival is `\(\phi_{posterior} = 0.56\)` with credible interval `\([0.51,0.61]\)`.

--

+ Using information on body mass and annual survival of 27 European passerines, we can predict survival of European dippers using only body mass.

--

+ For dippers, body mass is 59.8g, therefore `\(\phi = 0.57\)` with `\(\text{sd} = 0.073\)`.

--

+ Assuming an informative prior `\(\phi_{prior} \sim \text{Normal}(0.57,0.073^2)\)`.

--

+ Mean posterior `\(\phi_{posterior} = 0.56\)` with credible interval `\([0.52, 0.60]\)`.

--

+ No increase of precision in posterior inference.

---
# How to incorporate prior information?

--

+ Now if you had only the three first years of data, what would have happened?

--

+ Width of credible interval is 0.47 (vague prior) vs. 0.30 (informative prior).

--

+ Huge increase of precision in posterior inference ($40\%$ gain)!

+ Compare \textcolor{blue}{vague} vs. \textcolor{red}{informative} prior

&lt;!-- surv~dnorm(0.57,187.6) # Norm(0.57,sd=0.073) ; precision = 1/var = 1/0.073^2 --&gt;

---
# Prior elicitation via moment matching

--

+ Remember the Beta distribution

--

+ Recall that the Beta distribution is a continuous distribution with values between 0 and 1. Useful for modelling survival or detection probabilities. 

--

+ If `\(X \sim Beta(\alpha,\beta)\)`, then the first and second moments of `\(X\)` are:

`$$\mu = \text{E}(X) = \frac{\alpha}{\alpha + \beta}$$`

`$$\sigma^2 = \text{Var}(X) = \frac{\alpha\beta}{(\alpha + \beta)^2 (\alpha + \beta + 1)}$$`

---
# Moment matching

+ In the capture-recapture example, we know a priori that the mean of the probability we're interested in is `\(\mu = 0.57\)` and its variance is `\(\sigma^2 = 0.073^2\)`.

--

+ Parameters `\(\mu\)` and `\(\sigma^2\)` are seen as the moments of a `\(Beta(\alpha,\beta)\)` distribution.

---

+ Now we look for values of `\(\alpha\)` and `\(\beta\)` that match the observed moments of the Beta distribution ($\mu$ and `\(\sigma^2\)`).

--

+ We need another set of equations:

`$$\alpha = \bigg(\frac{1-\mu}{\sigma^2}- \frac{1}{\mu} \bigg)\mu^2$$`

`$$\beta = \alpha \bigg(\frac{1}{\mu}-1\bigg)$$`

--

+ For our model, that means:


```r
(alpha &lt;- ( (1 - 0.57)/(0.073*0.073) - (1/0.57) )*0.57^2)
```

```
[1] 25.64636
```

```r
(beta &lt;- alpha * ( (1/0.57) - 1))
```

```
[1] 19.34726
```

--

+ Now use `\(\phi_{prior} \sim \text{Beta}(\alpha = 25.6,\beta = 19.3)\)` instead of `\(\phi_{prior} \sim \text{Normal}(0.57,0.073^2)\)`

---
# Prior predictive checks

---
## Linear regression

--

.pull-left[

Unreasonable prior `\(\beta \sim N(0, 1000^2)\)`

&lt;img src="5_survival_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]

--

.pull-right[

Reasonable prior `\(\beta \sim N(2, 0.5^2)\)`

&lt;img src="5_survival_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]

---
## Logistic regression

--

.pull-left[

Unreasonable
`\(\text{logit}(\phi) = \beta \sim N(0, 10^2)\)`

&lt;img src="5_survival_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]

--

.pull-right[

Reasonable 
`\(\text{logit}(\phi) = \beta \sim N(0, 1.5^2)\)`

&lt;img src="5_survival_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto auto auto 0;" /&gt;
]




---
## Further reading

+ ref 1
+ ref 2
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"slideNumberFormat": ""
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
